'use strict';var onvif=require('node-onvif'),arpScanner=require('arpscan/promise'),xs=require('xstream').default;function getONVIFStream(a){var b=function getStreams(c){return c.map(function(d){var i=new onvif.OnvifDevice({xaddr:'http://'+d.ip+function getPort(j){return a.passwords&&a.passwords[j]?':'+a.passwords[j].port:''}(d.ip)+'/onvif/device_service',user:function getUser(j){return a.passwords&&a.passwords[j]?a.passwords[j].user:a.user}(d.ip),pass:function getPass(j){return a.passwords&&a.passwords[j]?a.passwords[j].pass:a.pass}(d.ip)});return new Promise(function(j){i.init(function(l){var m=i.getCurrentProfile();if(l)j(null);else try{m&&m.video&&m.video.encoder&&m.video.encoder.framerate?j(Object.assign({},d,{stream:i.getUdpStreamUrl(),fps:m.video.encoder.framerate})):j(Object.assign({},d,{stream:i.getUdpStreamUrl()}))}catch(n){j(null)}})})})};return arpScanner(a).then(function(c){return b(c)}).then(function(c){return Promise.all(c)}).then(function(c){return c.filter(function(d){return null!==d})})}function WrapONVIFStream(a){var b={};this.call=function(c,d){getONVIFStream(Object.assign({},a,{interface:d})).then(function(f){b[c](f)})},this.on=function(c,d){b[c]=d}}function makeONVIFStreamDriver(a){var c=new WrapONVIFStream(a);return function(d){return d.addListener({next:function next(f){c.call(f.category,f.interface)},error:function error(){},complete:function complete(){}}),{select:function select(f){return xs.create({start:function start(g){c.on(f,function(h){return g.next(h)})},stop:function stop(){}})}}}}module.exports=makeONVIFStreamDriver;